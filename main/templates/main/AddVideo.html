{% load static %}
<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adicionar Vídeo - Vitrine de Atletas</title>

<link rel="stylesheet" href="{% static 'css/tema.css' %}">
<link rel="stylesheet" href="{% static 'css/AddVideo.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header>
    <h1>Adicionar Novo Vídeo</h1>
    <a href="{% url 'paginaPrincipal' %}" class="back-btn">← Voltar</a>
</header>

<main>
    <div class="upload-container">
        <form id="videoForm">
            <label for="video">Escolha o vídeo:</label>
            <input type="file" id="video" accept="video/*" required>

            <label for="nome">Nome do Atleta:</label>
            <input type="text" id="nome" placeholder="Digite o nome do atleta" required>

            <label for="esporte">Esporte:</label>
            <select id="esporte" required>
                <option value="">Selecione o esporte</option>
                <option value="Futebol">Futebol</option>
                <option value="Basquete">Basquete</option>
                <option value="Vôlei">Vôlei</option>
                <option value="Tênis">Tênis</option>
            </select>

            <label for="regiao">Região:</label>
            <select id="regiao" required>
                <option value="">Selecione a região</option>
                <option value="Norte">Norte</option>
                <option value="Nordeste">Nordeste</option>
                <option value="Sudeste">Sudeste</option>
                <option value="Sul">Sul</option>
                <option value="Centro-Oeste">Centro-Oeste</option>
            </select>

            <label for="descricao">Descrição:</label>
            <textarea id="descricao" placeholder="Digite uma descrição para o vídeo" required></textarea>

            <button type="submit">Enviar Vídeo</button>
        </form>
    </div>
</main>

<script src="{% static 'js/tema.js' %}"></script>

<script>
// ===================== SALVAR VÍDEO NO LOCALSTORAGE =====================
document.getElementById("videoForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const arquivo = document.getElementById("video").files[0];

    if (!arquivo) {
        alert("Selecione um vídeo!");
        return;
    }

    const maxSize = 10 * 1024 * 1024; 
    if (arquivo.size > maxSize) {
        alert("O vídeo é muito grande! Tente enviar arquivos menores que 10MB.");
        return;
    }

    const leitor = new FileReader();

    leitor.onload = function(event) {
        const base64Video = event.target.result;

        const novoVideo = {
            id: Date.now(),
            nome: document.getElementById("nome").value,
            esporte: document.getElementById("esporte").value,
            regiao: document.getElementById("regiao").value,
            descricao: document.getElementById("descricao").value,
            url: base64Video,
            tipo: arquivo.type,
            likes: 0,
            jaDeuLike: false
        };

        let videos = JSON.parse(localStorage.getItem("videos")) || [];
        videos.push(novoVideo);
        localStorage.setItem("videos", JSON.stringify(videos));

        console.log("Vídeo salvo no localStorage:", novoVideo);

        alert("Vídeo enviado com sucesso!");
        window.location.href = "{% url 'paginaPrincipal' %}";
    };

    leitor.onerror = function() {
        alert("Erro ao ler o arquivo de vídeo.");
        console.error("Erro FileReader:", leitor.error);
    };

    leitor.readAsDataURL(arquivo);
});
</script>

</body>
</html>
