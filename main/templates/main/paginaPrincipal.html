{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vitrine de Atletas</title>

<link rel="stylesheet" href="{% static 'css/paginaPrincipal.css' %}">
<link rel="stylesheet" href="{% static 'css/tema.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
</head>
<body>

<!-- MENU E HEADER -->
<input type="checkbox" id="menu-toggle">
<div class="overlay"></div>

<header>
    <h1>Vitrine de Atletas</h1>
    <div class="header-right">
        <a href="{% url 'AddVideo' %}" class="add-video-btn">Adicionar Vídeo</a>
        <label for="menu-toggle" class="menu-icon">&#9776;</label>
    </div>
</header>

<nav class="side-menu">
    <label for="menu-toggle" class="close-menu">×</label>
    <ul>
        <li><a href="{% url 'perfil' %}">Perfil</a></li>
        <li><a href="{% url 'configuracoes' %}">Configurações</a></li>
        <li><a href="{% url 'index' %}">Sair</a></li>
    </ul>
</nav>

<!-- FILTROS -->
<section class="filters">
    <input type="text" placeholder="Buscar atleta..." class="search-bar">
    <select>
        <option value="All">Todas as Regiões</option>
        <option value="Norte">Norte</option>
        <option value="Nordeste">Nordeste</option>
        <option value="Sudeste">Sudeste</option>
        <option value="Sul">Sul</option>
        <option value="Centro-Oeste">Centro-Oeste</option>
    </select>
    <select>
        <option value="All">Todos os Esportes</option>
        <option value="Futebol">Futebol</option>
        <option value="Basquete">Basquete</option>
        <option value="Vôlei">Vôlei</option>
        <option value="Tênis">Tênis</option>
    </select>
</section>

<!-- SEÇÃO DOS CARDS DINÂMICOS -->
<section class="athlete-grid" id="videos-dinamicos"></section>

<script src="{% static 'js/tema.js' %}"></script>

<script>
// ====================== CARREGAR VÍDEOS ======================
function carregarVideos() {
    const container = document.getElementById("videos-dinamicos");
    const videos = JSON.parse(localStorage.getItem("videos")) || [];
    container.innerHTML = "";

    videos.forEach(v => {
        const card = document.createElement("a");
        card.href = "{% url 'AddVideo' %}";  // altere para a view correta
        card.classList.add("athlete-card");

        card.innerHTML = `
            <span class="badge novo">Novo</span>
            <video controls class="video-player">
                <source src="${v.url}" type="${v.tipo}">
                Seu navegador não suporta vídeos.
            </video>
            <div class="athlete-info">
                <h3>${v.nome}</h3>
                <p>${v.esporte} - ${v.regiao}</p>
                <div class="actions">
                    <input type="checkbox" id="like_${v.id}" class="like-checkbox">
                    <label for="like_${v.id}" class="like-btn">
                        <i class="fa-solid fa-thumbs-up"></i>
                    </label>
                    <span class="like-count" data-like-id="like_${v.id}">
                        ${v.likes || 0}
                    </span>
                    <button class="chat-btn">
                        <i class="fa-solid fa-comment"></i>
                    </button>
                </div>
            </div>
        `;

        container.appendChild(card);
    });

    ativarSistemaDeLikes();
}

// ====================== SISTEMA DE LIKES ======================
function ativarSistemaDeLikes() {
    document.querySelectorAll(".like-checkbox").forEach(checkbox => {
        const id = checkbox.id;
        const countElement = document.querySelector(`.like-count[data-like-id="${id}"]`);

        let estado = localStorage.getItem(id + "_state");
        let count = parseInt(localStorage.getItem(id + "_count")) || parseInt(countElement.textContent);

        if (estado === "liked") {
            checkbox.checked = true;
            checkbox.nextElementSibling.classList.add("liked");
        }

        checkbox.addEventListener("change", () => {
            if (checkbox.checked) {
                count++;
                localStorage.setItem(id + "_state", "liked");
                checkbox.nextElementSibling.classList.add("liked");
            } else {
                count--;
                localStorage.setItem(id + "_state", "unliked");
                checkbox.nextElementSibling.classList.remove("liked");
            }

            countElement.textContent = count;
            localStorage.setItem(id + "_count", count);
        });
    });
}

// Carregar vídeos ao abrir a página
carregarVideos();
</script>

</body>
</html>
